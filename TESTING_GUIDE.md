# テスト手順ガイド

## 概要

このドキュメントでは、保護者メールアドレス登録システムのテスト手順を体系的に説明します。

## テスト環境の準備

### テストデプロイメントの作成

開発中は、本番環境とは別にテスト用のデプロイメントを作成することを強く推奨します。

#### 手順

1. **GASエディタを開く**
   ```bash
   clasp open-script
   ```

2. **新しいデプロイを作成**
   - 右上の「デプロイ」ボタンをクリック
   - 「新しいデプロイ」を選択

3. **デプロイ設定**
   - 歯車アイコン（種類を選択）→「ウェブアプリ」を選択
   - **説明**: `テスト環境`
   - **次のユーザーとして実行**: `自分`
   - **アクセスできるユーザー**: `自分のみ`（テスト用）

4. **デプロイ実行**
   - 「デプロイ」ボタンをクリック
   - 表示されたURLをメモ（例: `https://script.google.com/macros/s/AKfycby.../dev`）

5. **テストURLの作成**
   ```
   https://script.google.com/macros/s/YOUR_DEPLOY_ID/dev?token=mebio-parent-reg-2025-k7m3x9p4
   ```

### テストデプロイメントの利点

- ✅ `clasp push`後、即座にテスト可能（再デプロイ不要）
- ✅ 本番環境に影響を与えない
- ✅ 自分のみアクセス可能

## 機能テスト

### 1. 新規登録フロー

#### テスト手順

1. **アクセス**
   - テストURLにアクセス
   - トップページが表示されることを確認

2. **新規登録を選択**
   - 「新規登録」ボタンをクリック
   - 登録フォームが表示されることを確認

3. **フォーム入力**
   - **世帯情報**
     - 郵便番号: `530-0001`（自動住所入力のテスト）
     - 住所: 自動入力されることを確認
     - 建物名: 任意入力
   - **保護者情報**（最低1人）
     - 氏名、フリガナ、続柄
     - メールアドレス（テスト用）
     - 携帯電話または自宅電話
     - 連絡優先順位
   - **生徒情報**（最低1人）
     - 氏名、フリガナ
     - 高校卒業予定年
     - メールアドレス（テスト用）

4. **確認画面**
   - 「確認画面へ」ボタンをクリック
   - 入力内容が正しく表示されることを確認

5. **登録実行**
   - 「この内容で登録する」ボタンをクリック
   - ローディング表示を確認
   - 完了画面が表示されることを確認
   - 編集コードが表示されることを確認（メモする）

6. **データ確認**
   - スプレッドシートを開く
   - 「世帯マスタ」「保護者」「生徒」シートにデータが保存されていることを確認

7. **メール確認**
   - 登録したメールアドレスに確認メールが届くことを確認
   - メール内容（編集コード、Magic Link）を確認

#### 期待される結果

- ✅ フォーム入力がスムーズ
- ✅ 郵便番号から住所が自動入力される
- ✅ 確認画面で入力内容が正しく表示される
- ✅ 登録完了画面が表示される
- ✅ スプレッドシートにデータが保存される
- ✅ 確認メールが届く

---

### 2. 編集フロー（編集コード認証）

#### テスト手順

1. **トップページにアクセス**
   - 「登録内容を編集」を選択

2. **認証**
   - メールアドレス: 登録時のメールアドレスを入力
   - 編集コード: 登録完了時に表示された編集コードを入力
   - 「ログイン」ボタンをクリック

3. **編集画面**
   - 既存のデータが正しく読み込まれていることを確認
   - データを一部変更（例: 電話番号を変更）

4. **確認・保存**
   - 「確認画面へ」ボタンをクリック
   - 変更内容を確認
   - 「この内容で登録する」ボタンをクリック

5. **データ確認**
   - スプレッドシートで変更が反映されていることを確認

#### 期待される結果

- ✅ 編集コードで認証できる
- ✅ 既存データが正しく読み込まれる
- ✅ 変更内容が保存される
- ✅ スプレッドシートが更新される

---

### 3. Magic Linkフロー

#### テスト手順

1. **トップページにアクセス**
   - 「登録内容を編集」を選択

2. **Magic Link送信**
   - メールアドレスを入力
   - 「編集リンクをメールで送信」ボタンをクリック
   - 「メールを送信しました」メッセージを確認

3. **メール確認**
   - 登録したメールアドレスにMagic Linkメールが届くことを確認
   - メール内のリンクをクリック

4. **編集画面**
   - 自動的にログインされ、編集画面が表示されることを確認
   - データを編集して保存

5. **有効期限テスト**
   - 30分以上経過したMagic Linkでアクセス
   - エラーメッセージが表示されることを確認

#### 期待される結果

- ✅ Magic Linkメールが届く
- ✅ リンクから自動ログインできる
- ✅ 有効期限切れのリンクはエラーになる

---

### 4. バリデーションテスト

#### テスト項目

1. **必須項目チェック**
   - 必須項目を空欄にして送信
   - エラーメッセージが表示されることを確認

2. **メールアドレス形式チェック**
   - 不正な形式のメールアドレスを入力
   - エラーメッセージが表示されることを確認

3. **郵便番号形式チェック**
   - 不正な形式の郵便番号を入力
   - エラーメッセージが表示されることを確認

4. **電話番号形式チェック**
   - 不正な形式の電話番号を入力
   - エラーメッセージが表示されることを確認

#### 期待される結果

- ✅ 適切なバリデーションエラーが表示される
- ✅ エラーメッセージが分かりやすい

---

## 既知の問題

### 現在確認中の問題

（テスト中に発見した問題をここに記録します）

#### 例:
- [ ] 問題1: 説明
  - 再現手順: ...
  - 期待される動作: ...
  - 実際の動作: ...
  - 優先度: 高/中/低

---

## テストチェックリスト

### 新規登録
- [ ] トップページ表示
- [ ] フォーム入力
- [ ] 郵便番号自動入力
- [ ] 確認画面表示
- [ ] 登録完了
- [ ] データ保存確認
- [ ] メール送信確認

### 編集（編集コード）
- [ ] 認証成功
- [ ] データ読み込み
- [ ] データ更新
- [ ] 保存確認

### Magic Link
- [ ] メール送信
- [ ] リンクアクセス
- [ ] 自動ログイン
- [ ] 有効期限チェック

### バリデーション
- [ ] 必須項目チェック
- [ ] メール形式チェック
- [ ] 郵便番号形式チェック
- [ ] 電話番号形式チェック

### レスポンシブデザイン
- [ ] PC表示
- [ ] スマホ表示（縦）
- [ ] スマホ表示（横）
- [ ] タブレット表示
