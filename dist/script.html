<script>
(() => {
  var __defProp = Object.defineProperty;
  var __getOwnPropSymbols = Object.getOwnPropertySymbols;
  var __hasOwnProp = Object.prototype.hasOwnProperty;
  var __propIsEnum = Object.prototype.propertyIsEnumerable;
  var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
  var __spreadValues = (a, b) => {
    for (var prop in b || (b = {}))
      if (__hasOwnProp.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    if (__getOwnPropSymbols)
      for (var prop of __getOwnPropSymbols(b)) {
        if (__propIsEnum.call(b, prop))
          __defNormalProp(a, prop, b[prop]);
      }
    return a;
  };
  var __async = (__this, __arguments, generator) => {
    return new Promise((resolve, reject) => {
      var fulfilled = (value) => {
        try {
          step(generator.next(value));
        } catch (e) {
          reject(e);
        }
      };
      var rejected = (value) => {
        try {
          step(generator.throw(value));
        } catch (e) {
          reject(e);
        }
      };
      var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
      step((generator = generator.apply(__this, __arguments)).next());
    });
  };

  // src/client/state/store.js
  var Store = class {
    constructor(initialState = {}) {
      this.state = initialState;
      this.listeners = [];
    }
    /**
     * Get the current state.
     * @returns {object} The current state.
     */
    getState() {
      return this.state;
    }
    /**
     * Update the state.
     * @param {object} newState - Partial state to update.
     */
    setState(newState) {
      this.state = __spreadValues(__spreadValues({}, this.state), newState);
      this.notify();
    }
    /**
     * Subscribe to state changes.
     * @param {function} listener - Callback function.
     * @returns {function} Unsubscribe function.
     */
    subscribe(listener) {
      this.listeners.push(listener);
      return () => {
        this.listeners = this.listeners.filter((l) => l !== listener);
      };
    }
    /**
     * Notify all listeners of state changes.
     */
    notify() {
      this.listeners.forEach((listener) => listener(this.state));
    }
  };
  var store = new Store({
    mode: "new",
    // 'new' or 'edit'
    guardianCount: 0,
    studentCount: 0,
    household: {},
    guardians: [],
    students: []
  });

  // src/client/infra/api.js
  function runServerFunction(functionName, ...args) {
    return new Promise((resolve, reject) => {
      google.script.run.withSuccessHandler(resolve).withFailureHandler(reject)[functionName](...args);
    });
  }

  // src/client/domain/validation.js
  function validateForm() {
    const postalCodeRegex = /^\d{3}-?\d{4}$/;
    const phoneRegex = /^0\d{1,4}-?\d{1,4}-?\d{3,4}$/;
    const householdPostalCode = document.getElementById("postalCode").value;
    if (householdPostalCode && !postalCodeRegex.test(householdPostalCode)) {
      return { valid: false, message: "\u4E16\u5E2F\u306E\u90F5\u4FBF\u756A\u53F7\u306E\u5F62\u5F0F\u304C\u6B63\u3057\u304F\u3042\u308A\u307E\u305B\u3093\u3002\uFF08\u4F8B: 123-4567\uFF09" };
    }
    const guardians = document.querySelectorAll(".guardian-card");
    for (let card of guardians) {
      const id = card.id;
      const mobile = card.querySelector('[name="mobile_phone_'.concat(id, '"]')).value;
      const home = card.querySelector('[name="home_phone_'.concat(id, '"]')).value;
      const postalCode = card.querySelector('[name="postalCode_'.concat(id, '"]')).value;
      if (!mobile && !home) {
        return { valid: false, message: "\u4FDD\u8B77\u8005\u306E\u643A\u5E2F\u96FB\u8A71\u307E\u305F\u306F\u81EA\u5B85\u96FB\u8A71\u306E\u3069\u3061\u3089\u304B1\u3064\u306F\u5FC5\u9808\u3067\u3059\u3002" };
      }
      if (mobile && !phoneRegex.test(mobile)) {
        return { valid: false, message: "\u4FDD\u8B77\u8005\u306E\u643A\u5E2F\u96FB\u8A71\u756A\u53F7\u306E\u5F62\u5F0F\u304C\u6B63\u3057\u304F\u3042\u308A\u307E\u305B\u3093\u3002" };
      }
      if (home && !phoneRegex.test(home)) {
        return { valid: false, message: "\u4FDD\u8B77\u8005\u306E\u81EA\u5B85\u96FB\u8A71\u756A\u53F7\u306E\u5F62\u5F0F\u304C\u6B63\u3057\u304F\u3042\u308A\u307E\u305B\u3093\u3002" };
      }
      if (postalCode && !postalCodeRegex.test(postalCode)) {
        return { valid: false, message: "\u4FDD\u8B77\u8005\u306E\u90F5\u4FBF\u756A\u53F7\u306E\u5F62\u5F0F\u304C\u6B63\u3057\u304F\u3042\u308A\u307E\u305B\u3093\u3002" };
      }
    }
    const students = document.querySelectorAll(".student-card");
    for (let card of students) {
      const id = card.id;
      const mobile = card.querySelector('[name="s_mobile_phone_'.concat(id, '"]')).value;
      const postalCode = card.querySelector('[name="postalCode_s_'.concat(id, '"]')).value;
      if (mobile && !phoneRegex.test(mobile)) {
        return { valid: false, message: "\u751F\u5F92\u306E\u643A\u5E2F\u96FB\u8A71\u756A\u53F7\u306E\u5F62\u5F0F\u304C\u6B63\u3057\u304F\u3042\u308A\u307E\u305B\u3093\u3002" };
      }
      if (postalCode && !postalCodeRegex.test(postalCode)) {
        return { valid: false, message: "\u751F\u5F92\u306E\u90F5\u4FBF\u756A\u53F7\u306E\u5F62\u5F0F\u304C\u6B63\u3057\u304F\u3042\u308A\u307E\u305B\u3093\u3002" };
      }
    }
    return { valid: true };
  }

  // src/client/ui/components/guardian.js
  function addGuardian(data = null) {
    const state = store.getState();
    const guardianCount = state.guardianCount + 1;
    store.setState({ guardianCount });
    const id = "guardian_" + guardianCount;
    const hasSeparateAddress = data && (data.postalCode || data.prefecture || data.city || data.street);
    const html = '\n    <div class="guardian-card fade-in" id="'.concat(id, '">\n      <input type="hidden" name="guardianId_').concat(id, '" value="').concat(data ? data.guardianId || "" : "", '">\n      <div class="card-header">\n        <h3>\u4FDD\u8B77\u8005').concat(guardianCount, "</h3>\n        ").concat(guardianCount > 1 ? '<button type="button" class="btn btn-danger btn-sm remove-btn" data-remove-guardian="'.concat(id, '">\u524A\u9664</button>') : "", '\n      </div>\n      \n      <div class="form-row">\n        <div class="form-group col-md-4">\n          <label>\u7D9A\u67C4 <span class="required">*</span></label>\n          <select class="form-control" name="relationship_').concat(id, '" required>\n            <option value="">\u9078\u629E</option>\n            <option value="\u7236" ').concat(data && data.relationship === "\u7236" ? "selected" : "", '>\u7236</option>\n            <option value="\u6BCD" ').concat(data && data.relationship === "\u6BCD" ? "selected" : "", '>\u6BCD</option>\n            <option value="\u7956\u7236" ').concat(data && data.relationship === "\u7956\u7236" ? "selected" : "", '>\u7956\u7236</option>\n            <option value="\u7956\u6BCD" ').concat(data && data.relationship === "\u7956\u6BCD" ? "selected" : "", '>\u7956\u6BCD</option>\n            <option value="\u305D\u306E\u4ED6" ').concat(data && data.relationship === "\u305D\u306E\u4ED6" ? "selected" : "", '>\u305D\u306E\u4ED6</option>\n          </select>\n        </div>\n        <div class="form-group col-md-4">\n          <label>\u9023\u7D61\u512A\u5148\u9806\u4F4D <span class="required">*</span></label>\n          <select class="form-control priority-select" name="priority_').concat(id, '" required data-initial-priority="').concat(data ? data.contactPriority || "" : "", '">\n            <!-- Dynamically generated -->\n          </select>\n        </div>\n        <div class="form-group col-md-4">\n          <label>\u9023\u7D61\u624B\u6BB5</label>\n          <select class="form-control" name="contact_method_').concat(id, '">\n            <option value="\u643A\u5E2F\u96FB\u8A71" ').concat(!data || data.contactMethod === "\u643A\u5E2F\u96FB\u8A71" ? "selected" : "", '>\u643A\u5E2F\u96FB\u8A71</option>\n            <option value="\u81EA\u5B85\u96FB\u8A71" ').concat(data && data.contactMethod === "\u81EA\u5B85\u96FB\u8A71" ? "selected" : "", '>\u81EA\u5B85\u96FB\u8A71</option>\n            <option value="\u30E1\u30FC\u30EB" ').concat(data && data.contactMethod === "\u30E1\u30FC\u30EB" ? "selected" : "", '>\u30E1\u30FC\u30EB</option>\n          </select>\n        </div>\n      </div>\n      \n      <div class="form-row">\n        <div class="form-group col-md-6">\n          <label>\u59D3 <span class="required">*</span></label>\n          <input type="text" class="form-control" name="last_name_').concat(id, '" value="').concat(data ? data.lastName : "", '" required>\n        </div>\n        <div class="form-group col-md-6">\n          <label>\u540D <span class="required">*</span></label>\n          <input type="text" class="form-control" name="first_name_').concat(id, '" value="').concat(data ? data.firstName : "", '" required>\n        </div>\n      </div>\n      \n      <div class="form-row">\n        <div class="form-group col-md-6">\n          <label>\u30D5\u30EA\u30AC\u30CA\uFF08\u59D3\uFF09 <span class="required">*</span></label>\n          <input type="text" class="form-control" name="last_name_kana_').concat(id, '" value="').concat(data ? data.lastNameKana : "", '" pattern="[\u30A1-\u30F6\u30FC]+" required>\n        </div>\n        <div class="form-group col-md-6">\n          <label>\u30D5\u30EA\u30AC\u30CA\uFF08\u540D\uFF09 <span class="required">*</span></label>\n          <input type="text" class="form-control" name="first_name_kana_').concat(id, '" value="').concat(data ? data.firstNameKana : "", '" pattern="[\u30A1-\u30F6\u30FC]+" required>\n        </div>\n      </div>\n      \n      <div class="form-group">\n        <label>\u9023\u7D61\u7528\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9 <span class="required">*</span></label>\n        <input type="email" class="form-control" name="email_').concat(id, '" value="').concat(data ? data.email : "", '" required>\n      </div>\n      \n      <div class="form-group">\n        <label>\u30AA\u30F3\u30E9\u30A4\u30F3\u9762\u8AC7\u7528\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\uFF08\u4EFB\u610F\uFF09</label>\n        <input type="email" class="form-control" name="meeting_email_').concat(id, '" value="').concat(data ? data.meetingEmail || "" : "", '">\n        <small class="form-text">\u{1F4A1} PC/\u30BF\u30D6\u30EC\u30C3\u30C8\u3067\u78BA\u8A8D\u3057\u3084\u3059\u3044\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u63A8\u5968</small>\n      </div>\n      \n      <div class="form-row">\n        <div class="form-group col-md-6">\n          <label>\u643A\u5E2F\u96FB\u8A71\u756A\u53F7</label>\n          <input type="tel" class="form-control" name="mobile_phone_').concat(id, '" value="').concat(data ? data.mobilePhone || "" : "", '" placeholder="090-1234-5678">\n        </div>\n        <div class="form-group col-md-6">\n          <label>\u81EA\u5B85\u96FB\u8A71\u756A\u53F7</label>\n          <input type="tel" class="form-control" name="home_phone_').concat(id, '" value="').concat(data ? data.homePhone || "" : "", '" placeholder="03-1234-5678">\n        </div>\n      </div>\n      <small class="form-text">\u{1F4DE} \u643A\u5E2F\u96FB\u8A71\u307E\u305F\u306F\u81EA\u5B85\u96FB\u8A71\u306E\u3069\u3061\u3089\u304B1\u3064\u306F\u5FC5\u305A\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044</small>\n\n      <!-- Address Input -->\n      <div class="form-group mt-3">\n        <div class="form-check">\n          <input class="form-check-input" type="checkbox" id="separate_address_').concat(id, '" data-toggle-address="').concat(id, '" ').concat(hasSeparateAddress ? "checked" : "", '>\n          <label class="form-check-label" for="separate_address_').concat(id, '">\n            \u3054\u81EA\u5B85\u3068\u7570\u306A\u308B\u4F4F\u6240\u3092\u767B\u9332\u3059\u308B\uFF08\u5358\u8EAB\u8D74\u4EFB\u7B49\uFF09\n          </label>\n        </div>\n      </div>\n      \n      <div id="address_fields_').concat(id, '" style="display: ').concat(hasSeparateAddress ? "block" : "none", ';" class="bg-light p-3 rounded">\n        <div class="form-row">\n          <div class="form-group col-md-4">\n            <label>\u90F5\u4FBF\u756A\u53F7</label>\n            <input type="text" id="postalCode_').concat(id, '" name="postalCode_').concat(id, '" class="form-control" placeholder="123-4567" maxlength="8" value="').concat(data ? data.postalCode || "" : "", '">\n            <button type="button" class="btn btn-sm btn-secondary mt-1" data-search-address="').concat(id, '">\u4F4F\u6240\u691C\u7D22</button>\n          </div>\n        </div>\n        <div class="form-row">\n          <div class="form-group col-md-4">\n            <label>\u90FD\u9053\u5E9C\u770C</label>\n            <select id="prefecture_').concat(id, '" name="prefecture_').concat(id, '" class="form-control">\n              <option value="">\u9078\u629E</option>\n              ').concat(generatePrefectureOptions(data ? data.prefecture : ""), '\n            </select>\n          </div>\n          <div class="form-group col-md-8">\n            <label>\u5E02\u533A\u753A\u6751</label>\n            <input type="text" id="city_').concat(id, '" name="city_').concat(id, '" class="form-control" value="').concat(data ? data.city || "" : "", '">\n          </div>\n        </div>\n        <div class="form-group">\n          <label>\u753A\u540D\u30FB\u756A\u5730\u30FB\u53F7</label>\n          <input type="text" id="street_').concat(id, '" name="street_').concat(id, '" class="form-control" value="').concat(data ? data.street || "" : "", '">\n        </div>\n        <div class="form-group">\n          <label>\u5EFA\u7269\u540D\u30FB\u90E8\u5C4B\u756A\u53F7</label>\n          <input type="text" id="building_').concat(id, '" name="building_').concat(id, '" class="form-control" value="').concat(data ? data.building || "" : "", '">\n        </div>\n      </div>\n    </div>\n  ');
    document.getElementById("guardiansList").insertAdjacentHTML("beforeend", html);
    updateGuardianPriorities();
  }
  function removeGuardian(id) {
    if (confirm("\u3053\u306E\u4FDD\u8B77\u8005\u3092\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F")) {
      document.getElementById(id).remove();
      updateGuardianPriorities();
    }
  }
  function updateGuardianPriorities() {
    const guardians = document.querySelectorAll(".guardian-card");
    const count = guardians.length;
    guardians.forEach((card, index) => {
      const select = card.querySelector(".priority-select");
      let currentValue = select.value;
      if (!currentValue) {
        currentValue = select.getAttribute("data-initial-priority");
      }
      if (!currentValue) {
        currentValue = index + 1;
      }
      let options = "";
      for (let i = 1; i <= count; i++) {
        options += '<option value="'.concat(i, '" ').concat(currentValue == i ? "selected" : "", ">").concat(i, "</option>");
      }
      select.innerHTML = options;
      select.setAttribute("data-current-value", select.value);
    });
  }
  function handlePriorityChange(e) {
    const target = e.target;
    const newValue = target.value;
    const oldValue = target.getAttribute("data-current-value");
    if (newValue === oldValue) return;
    const allSelects = document.querySelectorAll(".priority-select");
    let otherSelect = null;
    allSelects.forEach((select) => {
      if (select !== target && select.value === newValue) {
        otherSelect = select;
      }
    });
    if (otherSelect) {
      otherSelect.value = oldValue;
      otherSelect.setAttribute("data-current-value", oldValue);
    }
    target.setAttribute("data-current-value", newValue);
  }
  function generatePrefectureOptions(selectedPrefecture) {
    const prefectures = [
      "\u5317\u6D77\u9053",
      "\u9752\u68EE\u770C",
      "\u5CA9\u624B\u770C",
      "\u5BAE\u57CE\u770C",
      "\u79CB\u7530\u770C",
      "\u5C71\u5F62\u770C",
      "\u798F\u5CF6\u770C",
      "\u8328\u57CE\u770C",
      "\u6803\u6728\u770C",
      "\u7FA4\u99AC\u770C",
      "\u57FC\u7389\u770C",
      "\u5343\u8449\u770C",
      "\u6771\u4EAC\u90FD",
      "\u795E\u5948\u5DDD\u770C",
      "\u65B0\u6F5F\u770C",
      "\u5BCC\u5C71\u770C",
      "\u77F3\u5DDD\u770C",
      "\u798F\u4E95\u770C",
      "\u5C71\u68A8\u770C",
      "\u9577\u91CE\u770C",
      "\u5C90\u961C\u770C",
      "\u9759\u5CA1\u770C",
      "\u611B\u77E5\u770C",
      "\u4E09\u91CD\u770C",
      "\u6ECB\u8CC0\u770C",
      "\u4EAC\u90FD\u5E9C",
      "\u5927\u962A\u5E9C",
      "\u5175\u5EAB\u770C",
      "\u5948\u826F\u770C",
      "\u548C\u6B4C\u5C71\u770C",
      "\u9CE5\u53D6\u770C",
      "\u5CF6\u6839\u770C",
      "\u5CA1\u5C71\u770C",
      "\u5E83\u5CF6\u770C",
      "\u5C71\u53E3\u770C",
      "\u5FB3\u5CF6\u770C",
      "\u9999\u5DDD\u770C",
      "\u611B\u5A9B\u770C",
      "\u9AD8\u77E5\u770C",
      "\u798F\u5CA1\u770C",
      "\u4F50\u8CC0\u770C",
      "\u9577\u5D0E\u770C",
      "\u718A\u672C\u770C",
      "\u5927\u5206\u770C",
      "\u5BAE\u5D0E\u770C",
      "\u9E7F\u5150\u5CF6\u770C",
      "\u6C96\u7E04\u770C"
    ];
    return prefectures.map(
      (pref) => '<option value="'.concat(pref, '" ').concat(selectedPrefecture === pref ? "selected" : "", ">").concat(pref, "</option>")
    ).join("");
  }

  // src/client/ui/components/student.js
  function addStudent(data = null) {
    const state = store.getState();
    const studentCount = state.studentCount + 1;
    store.setState({ studentCount });
    const id = "student_" + studentCount;
    const hasSeparateAddress = data && (data.postalCode || data.prefecture || data.city || data.street);
    const html = '\n    <div class="student-card fade-in" id="'.concat(id, '">\n      <input type="hidden" name="studentId_').concat(id, '" value="').concat(data ? data.studentId || "" : "", '">\n      <div class="card-header">\n        <h3>\u751F\u5F92').concat(studentCount, "</h3>\n        ").concat(studentCount > 1 ? '<button type="button" class="btn btn-danger btn-sm remove-btn" data-remove-student="'.concat(id, '">\u524A\u9664</button>') : "", '\n      </div>\n      \n      <div class="form-row">\n\n\n\n        <div class="form-group col-md-6">\n          <label>\u59D3 <span class="required">*</span></label>\n          <input type="text" class="form-control" name="s_last_name_').concat(id, '" value="').concat(data ? data.lastName : "", '" required>\n        </div>\n        <div class="form-group col-md-6">\n          <label>\u540D <span class="required">*</span></label>\n          <input type="text" class="form-control" name="s_first_name_').concat(id, '" value="').concat(data ? data.firstName : "", '" required>\n        </div>\n      </div>\n      \n      <div class="form-row">\n        <div class="form-group col-md-6">\n          <label>\u30D5\u30EA\u30AC\u30CA\uFF08\u59D3\uFF09 <span class="required">*</span></label>\n          <input type="text" class="form-control" name="s_last_name_kana_').concat(id, '" value="').concat(data ? data.lastNameKana : "", '" pattern="[\u30A1-\u30F6\u30FC]+" required>\n        </div>\n        <div class="form-group col-md-6">\n          <label>\u30D5\u30EA\u30AC\u30CA\uFF08\u540D\uFF09 <span class="required">*</span></label>\n          <input type="text" class="form-control" name="s_first_name_kana_').concat(id, '" value="').concat(data ? data.firstNameKana : "", '" pattern="[\u30A1-\u30F6\u30FC]+" required>\n        </div>\n      </div>\n      \n      <div class="form-group">\n        <label>\u9AD8\u6821\u5352\u696D\uFF08\u4E88\u5B9A\uFF09\u5E74 <span class="required">*</span></label>\n        <select class="form-control" name="graduation_year_').concat(id, '" required>\n          <option value="">\u9078\u629E</option>\n          ').concat(generateYearOptions(data ? data.graduationYear : null), '\n        </select>\n      </div>\n      \n      <div class="form-group">\n        <label>\u9023\u7D61\u7528\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9 <span class="required">*</span></label>\n        <input type="email" class="form-control" name="s_email_').concat(id, '" value="').concat(data ? data.email : "", '" required>\n      </div>\n      \n      <div class="form-group">\n        <label>\u30AA\u30F3\u30E9\u30A4\u30F3\u6388\u696D\u7528\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\uFF08\u4EFB\u610F\uFF09</label>\n        <input type="email" class="form-control" name="s_class_email_').concat(id, '" value="').concat(data ? data.classEmail || "" : "", '">\n        <small class="form-text">\u{1F4A1} PC/\u30BF\u30D6\u30EC\u30C3\u30C8\u3067\u78BA\u8A8D\u3057\u3084\u3059\u3044\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u63A8\u5968</small>\n      </div>\n      \n      <div class="form-group">\n        <label>\u643A\u5E2F\u96FB\u8A71\u756A\u53F7\uFF08\u4EFB\u610F\uFF09</label>\n        <input type="tel" class="form-control" name="s_mobile_phone_').concat(id, '" value="').concat(data ? data.mobilePhone || "" : "", '" placeholder="090-1234-5678">\n        <small class="form-text">\u{1F4F1} \u304A\u6301\u3061\u306E\u5834\u5408\u306F\u5FC5\u305A\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044</small>\n      </div>\n\n       <!-- Address Input -->\n      <div class="form-group mt-3">\n        <div class="form-check">\n          <input class="form-check-input" type="checkbox" id="separate_address_s_').concat(id, '" data-toggle-address="s_').concat(id, '" ').concat(hasSeparateAddress ? "checked" : "", '>\n          <label class="form-check-label" for="separate_address_s_').concat(id, '">\n            \u3054\u81EA\u5B85\u3068\u7570\u306A\u308B\u4F4F\u6240\u3092\u767B\u9332\u3059\u308B\uFF08\u5BEE\u751F\u6D3B\u7B49\uFF09\n          </label>\n        </div>\n      </div>\n      \n      <div id="address_fields_s_').concat(id, '" style="display: ').concat(hasSeparateAddress ? "block" : "none", ';" class="bg-light p-3 rounded">\n        <div class="form-row">\n          <div class="form-group col-md-4">\n            <label>\u90F5\u4FBF\u756A\u53F7</label>\n            <input type="text" id="postalCode_s_').concat(id, '" name="postalCode_s_').concat(id, '" class="form-control" placeholder="123-4567" maxlength="8" value="').concat(data ? data.postalCode || "" : "", '">\n            <button type="button" class="btn btn-sm btn-secondary mt-1" data-search-address="s_').concat(id, '">\u4F4F\u6240\u691C\u7D22</button>\n          </div>\n        </div>\n        <div class="form-row">\n          <div class="form-group col-md-4">\n            <label>\u90FD\u9053\u5E9C\u770C</label>\n            <select id="prefecture_s_').concat(id, '" name="prefecture_s_').concat(id, '" class="form-control">\n              <option value="">\u9078\u629E</option>\n              ').concat(generatePrefectureOptions2(data ? data.prefecture : ""), '\n            </select>\n          </div>\n          <div class="form-group col-md-8">\n            <label>\u5E02\u533A\u753A\u6751</label>\n            <input type="text" id="city_s_').concat(id, '" name="city_s_').concat(id, '" class="form-control" value="').concat(data ? data.city || "" : "", '">\n          </div>\n        </div>\n        <div class="form-group">\n          <label>\u753A\u540D\u30FB\u756A\u5730\u30FB\u53F7</label>\n          <input type="text" id="street_s_').concat(id, '" name="street_s_').concat(id, '" class="form-control" value="').concat(data ? data.street || "" : "", '">\n        </div>\n        <div class="form-group">\n          <label>\u5EFA\u7269\u540D\u30FB\u90E8\u5C4B\u756A\u53F7</label>\n          <input type="text" id="building_s_').concat(id, '" name="building_s_').concat(id, '" class="form-control" value="').concat(data ? data.building || "" : "", '">\n        </div>\n      </div>\n    </div>\n  ');
    document.getElementById("studentsList").insertAdjacentHTML("beforeend", html);
  }
  function removeStudent(id) {
    if (confirm("\u3053\u306E\u751F\u5F92\u3092\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F")) {
      document.getElementById(id).remove();
    }
  }
  function generateYearOptions(selectedYear) {
    const currentYear = (/* @__PURE__ */ new Date()).getFullYear();
    const years = [];
    for (let i = -5; i <= 10; i++) {
      const year = currentYear + i;
      const selected = selectedYear && selectedYear == year ? "selected" : "";
      years.push('<option value="'.concat(year, '" ').concat(selected, ">").concat(year, "\u5E74</option>"));
    }
    return years.join("");
  }
  function generatePrefectureOptions2(selectedPrefecture) {
    const prefectures = [
      "\u5317\u6D77\u9053",
      "\u9752\u68EE\u770C",
      "\u5CA9\u624B\u770C",
      "\u5BAE\u57CE\u770C",
      "\u79CB\u7530\u770C",
      "\u5C71\u5F62\u770C",
      "\u798F\u5CF6\u770C",
      "\u8328\u57CE\u770C",
      "\u6803\u6728\u770C",
      "\u7FA4\u99AC\u770C",
      "\u57FC\u7389\u770C",
      "\u5343\u8449\u770C",
      "\u6771\u4EAC\u90FD",
      "\u795E\u5948\u5DDD\u770C",
      "\u65B0\u6F5F\u770C",
      "\u5BCC\u5C71\u770C",
      "\u77F3\u5DDD\u770C",
      "\u798F\u4E95\u770C",
      "\u5C71\u68A8\u770C",
      "\u9577\u91CE\u770C",
      "\u5C90\u961C\u770C",
      "\u9759\u5CA1\u770C",
      "\u611B\u77E5\u770C",
      "\u4E09\u91CD\u770C",
      "\u6ECB\u8CC0\u770C",
      "\u4EAC\u90FD\u5E9C",
      "\u5927\u962A\u5E9C",
      "\u5175\u5EAB\u770C",
      "\u5948\u826F\u770C",
      "\u548C\u6B4C\u5C71\u770C",
      "\u9CE5\u53D6\u770C",
      "\u5CF6\u6839\u770C",
      "\u5CA1\u5C71\u770C",
      "\u5E83\u5CF6\u770C",
      "\u5C71\u53E3\u770C",
      "\u5FB3\u5CF6\u770C",
      "\u9999\u5DDD\u770C",
      "\u611B\u5A9B\u770C",
      "\u9AD8\u77E5\u770C",
      "\u798F\u5CA1\u770C",
      "\u4F50\u8CC0\u770C",
      "\u9577\u5D0E\u770C",
      "\u718A\u672C\u770C",
      "\u5927\u5206\u770C",
      "\u5BAE\u5D0E\u770C",
      "\u9E7F\u5150\u5CF6\u770C",
      "\u6C96\u7E04\u770C"
    ];
    return prefectures.map(
      (pref) => '<option value="'.concat(pref, '" ').concat(selectedPrefecture === pref ? "selected" : "", ">").concat(pref, "</option>")
    ).join("");
  }

  // src/client/ui/form.js
  function showLoading(show) {
    const loading = document.getElementById("loading");
    const form = document.getElementById("registrationForm");
    if (loading) loading.style.display = show ? "block" : "none";
    if (form) form.style.display = show ? "none" : "block";
  }
  function showMessage(message, type) {
    const messageDiv = document.getElementById("message");
    if (!messageDiv) return;
    messageDiv.className = "alert alert-" + type;
    messageDiv.textContent = message;
    messageDiv.style.display = "block";
    if (type === "success") {
      setTimeout(() => {
        messageDiv.style.display = "none";
      }, 3e3);
    }
  }
  function handleModeChange() {
    const modeInput = document.querySelector('input[name="mode"]:checked');
    if (!modeInput) return;
    const mode = modeInput.value;
    store.setState({ mode });
    const editAuthSection = document.getElementById("editAuthSection");
    const householdSection = document.getElementById("householdSection");
    const guardiansSection = document.getElementById("guardiansSection");
    const studentsSection = document.getElementById("studentsSection");
    const notesSection = document.getElementById("notesSection");
    const submitSection = document.getElementById("submitSection");
    if (mode === "new") {
      if (editAuthSection) editAuthSection.style.display = "none";
      if (householdSection) householdSection.style.display = "block";
      if (guardiansSection) guardiansSection.style.display = "block";
      if (studentsSection) studentsSection.style.display = "block";
      if (notesSection) notesSection.style.display = "block";
      if (submitSection) submitSection.style.display = "block";
      const state = store.getState();
      if (state.guardianCount === 0) addGuardian();
      if (state.studentCount === 0) addStudent();
    } else {
      if (editAuthSection) editAuthSection.style.display = "block";
      if (householdSection) householdSection.style.display = "none";
      if (guardiansSection) guardiansSection.style.display = "none";
      if (studentsSection) studentsSection.style.display = "none";
      if (notesSection) notesSection.style.display = "none";
      if (submitSection) submitSection.style.display = "none";
    }
  }
  function authenticateEdit() {
    return __async(this, null, function* () {
      const email = document.getElementById("authEmail").value.trim();
      const editCode = document.getElementById("editCode").value.trim();
      if (!email) {
        showMessage("\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002", "danger");
        return;
      }
      if (!editCode) {
        showMessage("\u7DE8\u96C6\u30B3\u30FC\u30C9\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002", "danger");
        return;
      }
      showLoading(true);
      try {
        const result = yield runServerFunction("authenticateWithEditCode", email, editCode);
        console.log("authenticateWithEditCode result:", result);
        showLoading(false);
        if (!result) {
          throw new Error("\u30B5\u30FC\u30D0\u30FC\u304B\u3089\u306E\u5FDC\u7B54\u304C\u3042\u308A\u307E\u305B\u3093\u3002");
        }
        if (result.success) {
          let data = result.householdData;
          if (typeof data === "string") {
            try {
              data = JSON.parse(data);
            } catch (e) {
              console.error("Failed to parse householdData JSON:", e);
            }
          }
          loadHouseholdData(data);
          showMessage("\u8A8D\u8A3C\u306B\u6210\u529F\u3057\u307E\u3057\u305F\u3002", "success");
        } else {
          showMessage(result.message, "danger");
        }
      } catch (error) {
        showLoading(false);
        console.error("Authentication error:", error);
        showMessage("\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F: " + error.message, "danger");
      }
    });
  }
  function requestMagicLink() {
    return __async(this, null, function* () {
      const email = document.getElementById("authEmail").value.trim();
      if (!email) {
        showMessage("\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002", "danger");
        return;
      }
      showLoading(true);
      try {
        const result = yield runServerFunction("requestMagicLink", email);
        showLoading(false);
        if (result.success) {
          showMessage(result.message, "success");
        } else {
          showMessage(result.message, "danger");
        }
      } catch (error) {
        showLoading(false);
        showMessage("\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F: " + error.message, "danger");
      }
    });
  }
  function loadHouseholdData(householdData) {
    const editAuthSection = document.getElementById("editAuthSection");
    if (editAuthSection) editAuthSection.style.display = "none";
    const modeSections = document.querySelectorAll(".form-section");
    if (modeSections.length > 0) {
      modeSections[0].style.display = "none";
    }
    document.getElementById("householdSection").style.display = "block";
    document.getElementById("guardiansSection").style.display = "block";
    document.getElementById("studentsSection").style.display = "block";
    document.getElementById("notesSection").style.display = "block";
    document.getElementById("submitSection").style.display = "block";
    const submitBtn = document.querySelector('#submitSection button[type="submit"]');
    if (submitBtn) {
      submitBtn.textContent = "\u66F4\u65B0";
    }
    store.setState({ mode: "edit" });
    if (householdData.household) {
      const h = householdData.household;
      store.setState({ householdId: h.householdId });
      document.getElementById("postalCode").value = h.postalCode || "";
      document.getElementById("prefecture").value = h.prefecture || "";
      document.getElementById("city").value = h.city || "";
      document.getElementById("street").value = h.street || "";
      document.getElementById("building").value = h.building || "";
      document.getElementById("notes").value = h.notes || "";
    }
    document.getElementById("guardiansList").innerHTML = "";
    store.setState({ guardianCount: 0 });
    if (householdData.guardians && householdData.guardians.length > 0) {
      householdData.guardians.forEach((guardian) => {
        addGuardian(guardian);
      });
    }
    document.getElementById("studentsList").innerHTML = "";
    store.setState({ studentCount: 0 });
    if (householdData.students && householdData.students.length > 0) {
      householdData.students.forEach((student) => {
        addStudent(student);
      });
    }
  }
  function collectFormData() {
    const formData = {
      household: {
        postalCode: document.getElementById("postalCode").value,
        prefecture: document.getElementById("prefecture").value,
        city: document.getElementById("city").value,
        street: document.getElementById("street").value,
        building: document.getElementById("building").value,
        notes: document.getElementById("notes").value
      },
      guardians: [],
      students: []
    };
    document.querySelectorAll(".guardian-card").forEach((card) => {
      const id = card.id;
      const getVal = (name) => {
        const el = card.querySelector('[name="'.concat(name, '"]'));
        return el ? el.value : "";
      };
      const separateAddressCheckbox = document.getElementById("separate_address_".concat(id));
      const useSeparateAddress = separateAddressCheckbox && separateAddressCheckbox.checked;
      formData.guardians.push({
        guardianId: getVal("guardianId_".concat(id)),
        // Collect hidden ID
        relationship: getVal("relationship_".concat(id)),
        contactPriority: getVal("priority_".concat(id)) ? parseInt(getVal("priority_".concat(id))) : "",
        contactMethod: getVal("contact_method_".concat(id)),
        lastName: getVal("last_name_".concat(id)),
        firstName: getVal("first_name_".concat(id)),
        lastNameKana: getVal("last_name_kana_".concat(id)),
        firstNameKana: getVal("first_name_kana_".concat(id)),
        email: getVal("email_".concat(id)),
        meetingEmail: getVal("meeting_email_".concat(id)),
        mobilePhone: getVal("mobile_phone_".concat(id)),
        homePhone: getVal("home_phone_".concat(id)),
        // Address fields - clear if not using separate address
        postalCode: useSeparateAddress ? getVal("postalCode_".concat(id)) : "",
        prefecture: useSeparateAddress ? getVal("prefecture_".concat(id)) : "",
        city: useSeparateAddress ? getVal("city_".concat(id)) : "",
        street: useSeparateAddress ? getVal("street_".concat(id)) : "",
        building: useSeparateAddress ? getVal("building_".concat(id)) : ""
      });
    });
    document.querySelectorAll(".student-card").forEach((card) => {
      const id = card.id;
      const getVal = (name) => {
        const el = card.querySelector('[name="'.concat(name, '"]'));
        return el ? el.value : "";
      };
      const separateAddressCheckbox = document.getElementById("separate_address_s_".concat(id));
      const useSeparateAddress = separateAddressCheckbox && separateAddressCheckbox.checked;
      formData.students.push({
        studentId: getVal("studentId_".concat(id)),
        // Collect hidden ID
        lastName: getVal("s_last_name_".concat(id)),
        firstName: getVal("s_first_name_".concat(id)),
        lastNameKana: getVal("s_last_name_kana_".concat(id)),
        firstNameKana: getVal("s_first_name_kana_".concat(id)),
        graduationYear: getVal("graduation_year_".concat(id)),
        email: getVal("s_email_".concat(id)),
        classEmail: getVal("s_class_email_".concat(id)),
        mobilePhone: getVal("s_mobile_phone_".concat(id)),
        // Address fields - clear if not using separate address
        postalCode: useSeparateAddress ? getVal("postalCode_s_".concat(id)) : "",
        prefecture: useSeparateAddress ? getVal("prefecture_s_".concat(id)) : "",
        city: useSeparateAddress ? getVal("city_s_".concat(id)) : "",
        street: useSeparateAddress ? getVal("street_s_".concat(id)) : "",
        building: useSeparateAddress ? getVal("building_s_".concat(id)) : ""
      });
    });
    return formData;
  }
  var pendingFormData = null;
  function showConfirmation(formData) {
    pendingFormData = formData;
    const contentDiv = document.getElementById("confirmationContent");
    if (!contentDiv) return;
    let html = '<div class="confirmation-details">';
    html += "<h3>\u{1F4CD} \u3054\u81EA\u5B85\u4F4F\u6240</h3>";
    html += "<p>\u3012".concat(formData.household.postalCode, "<br>");
    html += "".concat(formData.household.prefecture, " ").concat(formData.household.city, " ").concat(formData.household.street, " ").concat(formData.household.building, "</p>");
    if (formData.household.notes) {
      html += "<p><strong>\u5099\u8003:</strong><br>".concat(formData.household.notes.replace(/\n/g, "<br>"), "</p>");
    }
    html += "<hr>";
    html += "<h3>\u{1F468}\u200D\u{1F469}\u200D\u{1F467}\u200D\u{1F466} \u4FDD\u8B77\u8005\u60C5\u5831</h3>";
    formData.guardians.forEach((g, index) => {
      html += '<div class="mb-3"><strong>\u4FDD\u8B77\u8005'.concat(index + 1, ": ").concat(g.lastName, " ").concat(g.firstName, "</strong>");
      html += "<br>\u30AB\u30CA: ".concat(g.lastNameKana, " ").concat(g.firstNameKana);
      html += "<br>\u7D9A\u67C4: ".concat(g.relationship);
      html += "<br>\u9023\u7D61\u512A\u5148\u9806\u4F4D: ".concat(g.contactPriority, "\u4F4D");
      html += "<br>\u9023\u7D61\u65B9\u6CD5: ".concat(g.contactMethod);
      if (g.mobilePhone) html += "<br>\u643A\u5E2F\u96FB\u8A71: ".concat(g.mobilePhone);
      if (g.homePhone) html += "<br>\u81EA\u5B85\u96FB\u8A71: ".concat(g.homePhone);
      html += "<br>Email: ".concat(g.email);
      if (g.meetingEmail) html += "<br>\u30AA\u30F3\u30E9\u30A4\u30F3\u9762\u8AC7\u7528Email: ".concat(g.meetingEmail);
      if (g.postalCode) {
        html += "<br>\u4F4F\u6240: \u3012".concat(g.postalCode, " ").concat(g.prefecture, " ").concat(g.city, " ").concat(g.street, " ").concat(g.building);
      } else {
        html += "<br>\u4F4F\u6240: \u3054\u81EA\u5B85\u3068\u540C\u3058";
      }
      html += "</div>";
    });
    html += "<hr>";
    html += "<h3>\u{1F468}\u200D\u{1F393} \u751F\u5F92\u60C5\u5831</h3>";
    formData.students.forEach((s, index) => {
      html += '<div class="mb-3"><strong>\u751F\u5F92'.concat(index + 1, ": ").concat(s.lastName, " ").concat(s.firstName, "</strong>");
      html += "<br>\u30AB\u30CA: ".concat(s.lastNameKana, " ").concat(s.firstNameKana);
      html += "<br>\u5352\u696D\u4E88\u5B9A: ".concat(s.graduationYear, "\u5E743\u6708");
      if (s.email) html += "<br>Email: ".concat(s.email);
      if (s.classEmail) html += "<br>Classroom\u7528Email: ".concat(s.classEmail);
      if (s.mobilePhone) html += "<br>\u643A\u5E2F\u96FB\u8A71: ".concat(s.mobilePhone);
      if (s.postalCode) {
        html += "<br>\u4F4F\u6240: \u3012".concat(s.postalCode, " ").concat(s.prefecture, " ").concat(s.city, " ").concat(s.street, " ").concat(s.building);
      } else {
        html += "<br>\u4F4F\u6240: \u3054\u81EA\u5B85\u3068\u540C\u3058";
      }
      html += "</div>";
    });
    html += "</div>";
    contentDiv.innerHTML = html;
    document.getElementById("registrationForm").style.display = "none";
    document.getElementById("confirmationSection").style.display = "block";
    window.scrollTo(0, 0);
  }
  function handleFinalSubmit() {
    return __async(this, null, function* () {
      if (!pendingFormData) return;
      showLoading(true);
      document.getElementById("confirmationSection").style.display = "none";
      try {
        const state = store.getState();
        let result;
        if (state.mode === "edit") {
          if (!state.householdId) {
            throw new Error("\u4E16\u5E2FID\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002");
          }
          result = yield runServerFunction("updateHouseholdData", state.householdId, pendingFormData);
        } else {
          result = yield runServerFunction("submitRegistration", pendingFormData);
        }
        showLoading(false);
        if (result.success) {
          showMessage(result.message, "success");
          document.getElementById("confirmationSection").innerHTML = '\n        <div class="text-center py-5">\n          <h2 class="text-success mb-4">\u9001\u4FE1\u5B8C\u4E86</h2>\n          <p>'.concat(result.message, "</p>\n          <p>\u3053\u306E\u753B\u9762\u3092\u9589\u3058\u3066\u304F\u3060\u3055\u3044\u3002</p>\n        </div>\n      ");
          document.getElementById("confirmationSection").style.display = "block";
        } else {
          showMessage(result.message, "danger");
          document.getElementById("registrationForm").style.display = "block";
        }
      } catch (error) {
        showLoading(false);
        showMessage("\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F: " + error.message, "danger");
        document.getElementById("registrationForm").style.display = "block";
      }
    });
  }
  function handleSubmit(e) {
    return __async(this, null, function* () {
      e.preventDefault();
      const validation = validateForm();
      if (!validation.valid) {
        if (validation.message) showMessage(validation.message, "danger");
        return;
      }
      const formData = collectFormData();
      showConfirmation(formData);
    });
  }
  function searchAddress(postalCodeInputId, prefectureId, cityId, streetId) {
    return __async(this, null, function* () {
      const postalCodeInput = document.getElementById(postalCodeInputId);
      if (!postalCodeInput) return;
      const postalCode = postalCodeInput.value.replace(/-/g, "");
      if (postalCode.length !== 7) {
        showMessage("\u90F5\u4FBF\u756A\u53F7\u306F7\u6841\u3067\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002", "danger");
        return;
      }
      showLoading(true);
      try {
        const response = yield fetch("https://zipcloud.ibsnet.co.jp/api/search?zipcode=" + postalCode);
        const data = yield response.json();
        showLoading(false);
        if (data.results) {
          const result = data.results[0];
          document.getElementById(prefectureId).value = result.address1;
          document.getElementById(cityId).value = result.address2;
          document.getElementById(streetId).value = result.address3;
          showMessage("\u4F4F\u6240\u3092\u81EA\u52D5\u5165\u529B\u3057\u307E\u3057\u305F\u3002", "success");
        } else {
          showMessage("\u90F5\u4FBF\u756A\u53F7\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002", "danger");
        }
      } catch (error) {
        showLoading(false);
        console.error("\u4F4F\u6240\u691C\u7D22\u30A8\u30E9\u30FC:", error);
        showMessage("\u4F4F\u6240\u691C\u7D22\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002", "danger");
      }
    });
  }
  function toggleAddress(id) {
    const checkbox = document.getElementById("separate_address_".concat(id));
    const fields = document.getElementById("address_fields_".concat(id));
    if (checkbox && fields) {
      fields.style.display = checkbox.checked ? "block" : "none";
    }
  }

  // src/client/main.js
  window.addGuardian = addGuardian;
  window.addStudent = addStudent;
  window.authenticateEdit = authenticateEdit;
  window.requestMagicLink = requestMagicLink;
  window.handleFinalSubmit = handleFinalSubmit;
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll('input[name="mode"]').forEach((radio) => {
      radio.addEventListener("change", handleModeChange);
    });
    handleModeChange();
    const form = document.getElementById("registrationForm");
    if (form) {
      form.addEventListener("submit", handleSubmit);
    }
    const searchBtn = document.getElementById("searchAddressBtn");
    if (searchBtn) {
      searchBtn.addEventListener("click", () => {
        searchAddress("postalCode", "prefecture", "city", "street");
      });
    }
    document.addEventListener("click", (e) => {
      const target = e.target;
      if (target.matches("[data-remove-guardian]")) {
        const id = target.getAttribute("data-remove-guardian");
        removeGuardian(id);
      }
      if (target.matches("[data-remove-student]")) {
        const id = target.getAttribute("data-remove-student");
        removeStudent(id);
      }
      if (target.matches("[data-search-address]")) {
        const id = target.getAttribute("data-search-address");
        if (id.startsWith("s_")) {
          searchAddress("postalCode_".concat(id), "prefecture_".concat(id), "city_".concat(id), "street_".concat(id));
        } else {
          searchAddress("postalCode_".concat(id), "prefecture_".concat(id), "city_".concat(id), "street_".concat(id));
        }
      }
    });
    document.addEventListener("change", (e) => {
      const target = e.target;
      if (target.matches("[data-toggle-address]")) {
        const id = target.getAttribute("data-toggle-address");
        toggleAddress(id);
      }
      if (target.matches(".priority-select")) {
        handlePriorityChange(e);
      }
    });
  });
})();

</script>